# è¿­ä»£ 2 å®Œæˆè¯´æ˜ - ç½‘é¡µé›†æˆ

**å®Œæˆæ—¶é—´**: 2025-11-09  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å…³è”æ–‡æ¡£**: [å›¾ç‰‡ç”ŸæˆåŠŸèƒ½éœ€æ±‚ä¸è®¾è®¡æ–‡æ¡£](./å›¾ç‰‡ç”ŸæˆåŠŸèƒ½éœ€æ±‚ä¸è®¾è®¡æ–‡æ¡£.md), [è¿­ä»£1å®Œæˆè¯´æ˜](./è¿­ä»£1å®Œæˆè¯´æ˜.md)

---

## ğŸ“‹ å®Œæˆçš„ä»»åŠ¡

### âœ… ä»»åŠ¡ 1: æ›´æ–° generate_webpage èŠ‚ç‚¹ (`src/nodes.py`)

**ä¸»è¦å˜æ›´**:
1. **æ¥æ”¶å›¾ç‰‡ä¿¡æ¯**: ä»çŠ¶æ€ä¸­è¯»å– `generated_images`
2. **æ„å»ºå›¾ç‰‡ä¿¡æ¯å­—ç¬¦ä¸²**: å°†å›¾ç‰‡åˆ—è¡¨è½¬æ¢ä¸º prompt å¯è¯»çš„æ ¼å¼
3. **æ›´æ–°ç³»ç»Ÿ Prompt**: æ·»åŠ å›¾ç‰‡é›†æˆçš„æŒ‡å¯¼è¯´æ˜
4. **æ›´æ–°ç”¨æˆ· Prompt**: åœ¨ä¸¤ç§åœºæ™¯ï¼ˆé¦–æ¬¡ç”Ÿæˆã€ä¿®æ”¹ç½‘é¡µï¼‰ä¸‹éƒ½åŒ…å«å›¾ç‰‡ä¿¡æ¯

**å…³é”®ä»£ç ç‰‡æ®µ**:
```python
generated_images = state.get("generated_images", [])

# æ„å»ºå›¾ç‰‡ä¿¡æ¯å­—ç¬¦ä¸²
images_info = ""
if generated_images:
    images_info = "\n\nå¯ç”¨å›¾ç‰‡èµ„æºï¼š\n"
    for img in generated_images:
        images_info += f"- ID: {img['id']}, è·¯å¾„: {img['file_path']}, æè¿°: {img['alt_text']}\n"
```

**æ–°å¢ Prompt æŒ‡å¯¼**:
```
**å›¾ç‰‡é›†æˆï¼ˆv2.0 æ–°å¢ï¼‰**ï¼š
- å¦‚æœæä¾›äº†å›¾ç‰‡èµ„æºï¼Œå¿…é¡»åœ¨ HTML ä¸­ä½¿ç”¨ <img> æ ‡ç­¾å¼•ç”¨
- å›¾ç‰‡è·¯å¾„ä½¿ç”¨æä¾›çš„ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ ./images/lesson_xxx/word_dolphin.pngï¼‰
- å¿…é¡»ä¸ºæ¯ä¸ªå›¾ç‰‡æ·»åŠ  alt å±æ€§
- å•è¯å›¾ç‰‡ï¼šæ˜¾ç¤ºåœ¨å•è¯å¡ç‰‡ä¸­ï¼Œå·¦ä¾§å›¾ç‰‡ï¼ˆ150-200pxï¼‰ï¼Œå³ä¾§æ–‡å­—å’Œå‘éŸ³æŒ‰é’®
- å¥å­å›¾ç‰‡ï¼šæ˜¾ç¤ºåœ¨å¥å­ä¸Šæ–¹æˆ–å·¦ä¾§ï¼ˆ400-600pxå®½ï¼‰ï¼Œä½œä¸ºåœºæ™¯é…å›¾
- å›¾ç‰‡æ ·å¼ï¼šåœ†è§’ï¼ˆborder-radius: 12pxï¼‰ã€é˜´å½±ï¼ˆbox-shadowï¼‰ã€é€‚å½“çš„ margin
```

### âœ… ä»»åŠ¡ 2: æ›´æ–° graph.py é›†æˆæ–°èŠ‚ç‚¹

**ä¸»è¦å˜æ›´**:
1. **å¯¼å…¥æ–°èŠ‚ç‚¹**: æ·»åŠ  `analyze_image_needs` å’Œ `generate_images`
2. **æ·»åŠ èŠ‚ç‚¹åˆ°å›¾**: åœ¨å·¥ä½œæµä¸­æ³¨å†Œæ–°èŠ‚ç‚¹
3. **æ›´æ–°æµç¨‹è¾¹**: ä¿®æ”¹æµç¨‹ä¸º `finalize_content -> analyze_image_needs -> generate_images -> generate_webpage -> deploy_webpage_node`

**æµç¨‹å¯¹æ¯”**:

**v1.0 æµç¨‹**:
```
finalize_content â†’ generate_webpage â†’ deploy_webpage_node
```

**v2.0 æµç¨‹**:
```
finalize_content â†’ analyze_image_needs â†’ generate_images â†’ generate_webpage â†’ deploy_webpage_node
```

**å…³é”®ä»£ç **:
```python
# å¯¼å…¥
from .nodes import (
    load_framework,
    generate_initial_draft,
    revise_draft,
    finalize_content,
    analyze_image_needs,      # v2.0 æ–°å¢
    generate_images,           # v2.0 æ–°å¢
    generate_webpage,
    deploy_webpage_node,
)

# æ·»åŠ èŠ‚ç‚¹
workflow.add_node("analyze_image_needs", analyze_image_needs)
workflow.add_node("generate_images", generate_images)

# æ›´æ–°è¾¹
workflow.add_edge("finalize_content", "analyze_image_needs")
workflow.add_edge("analyze_image_needs", "generate_images")
workflow.add_edge("generate_images", "generate_webpage")
```

### âœ… ä»»åŠ¡ 3: åˆ›å»ºç«¯åˆ°ç«¯æµ‹è¯•è„šæœ¬

**æµ‹è¯•è„šæœ¬**: `_test_full_flow_with_images.py`
- æµ‹è¯•å®Œæ•´æµç¨‹ï¼šè¯¾ç¨‹ç”Ÿæˆ â†’ å›¾ç‰‡ç”Ÿæˆ â†’ ç½‘é¡µéƒ¨ç½²
- éªŒè¯å›¾ç‰‡é›†æˆåˆ° HTML ä¸­
- æ£€æŸ¥æ–‡ä»¶ç”Ÿæˆå’Œéƒ¨ç½²

---

## ğŸ”„ å®Œæ•´æµç¨‹å›¾ï¼ˆv2.0ï¼‰

```
START
  â†“
load_framework
  â†“
generate_initial_draft
  â†“
[ä¸­æ–­ - ç­‰å¾…ç”¨æˆ·å®¡æ ¸è¯¾ç¨‹å†…å®¹]
  â†“
ç”¨æˆ·åé¦ˆè·¯ç”±
  â”œâ”€ approve â†’ finalize_content
  â””â”€ revise â†’ revise_draft â†’ [å¾ªç¯å›å®¡æ ¸]
              â†“
        finalize_content
              â†“
    analyze_image_needs  â† ã€æ–°å¢ã€‘LLM åˆ†æè¯¾ç¨‹ï¼Œæå–å›¾ç‰‡éœ€æ±‚
              â†“
      generate_images    â† ã€æ–°å¢ã€‘è°ƒç”¨ Gemini API æ‰¹é‡ç”Ÿæˆå›¾ç‰‡
              â†“
      generate_webpage     ï¼ˆæ›´æ–°ï¼šæ¥æ”¶å›¾ç‰‡ä¿¡æ¯ï¼Œç”ŸæˆåŒ…å« <img> çš„ HTMLï¼‰
              â†“
    deploy_webpage_node    ï¼ˆéƒ¨ç½² HTML + å›¾ç‰‡ç›®å½•ï¼‰
              â†“
    [ä¸­æ–­ - ç­‰å¾…ç”¨æˆ·å®¡æ ¸ç½‘é¡µ]
              â†“
    ç”¨æˆ·åé¦ˆè·¯ç”±
      â”œâ”€ approve â†’ END
      â””â”€ revise â†’ generate_webpage â†’ [å¾ªç¯å›å®¡æ ¸]
```

---

## ğŸ§ª å¦‚ä½•æµ‹è¯•

### å¿«é€Ÿæµ‹è¯•ï¼ˆç«¯åˆ°ç«¯ï¼‰

```bash
# è¿è¡Œå®Œæ•´æµç¨‹æµ‹è¯•
python _test_full_flow_with_images.py

# å½“è¯¢é—®æ˜¯å¦ç»§ç»­æ—¶ï¼Œè¾“å…¥ y
```

**æ³¨æ„**:
- æ­¤æµ‹è¯•ä¼šè°ƒç”¨ Gemini API ç”Ÿæˆå›¾ç‰‡
- é¢„è®¡è€—æ—¶: 40-60 ç§’
- é¢„è®¡æ¶ˆè€—: çº¦ 5-7 å¼ å›¾ç‰‡çš„ API é…é¢

### é¢„æœŸè¾“å‡º

```
ğŸš€ å®Œæ•´æµç¨‹æµ‹è¯•ï¼šè¯¾ç¨‹ç”Ÿæˆ + å›¾ç‰‡ç”Ÿæˆ + ç½‘é¡µéƒ¨ç½²
====================================================================

ğŸ“Œ æ­¥éª¤ 1: å¯åŠ¨æµç¨‹ - ç”Ÿæˆåˆç¨¿
âœ… åˆç¨¿ç”Ÿæˆå®Œæˆ
   è‰ç¨¿é•¿åº¦: 1234 å­—ç¬¦

ğŸ“Œ æ­¥éª¤ 2: ç”¨æˆ·åŒæ„è¯¾ç¨‹å†…å®¹

ğŸ“Œ æ­¥éª¤ 3-7: è‡ªåŠ¨æ‰§è¡Œå›¾ç‰‡ç”Ÿæˆå’Œç½‘é¡µéƒ¨ç½²...

====================================================================
ğŸ“Š æµç¨‹æ‰§è¡Œç»“æœ
====================================================================

âœ… æœ€ç»ˆè¯¾ç¨‹å†…å®¹: 1234 å­—ç¬¦
âœ… è¯¾ç¨‹ID: 20251109_103853
âœ… å›¾ç‰‡éœ€æ±‚æ•°é‡: 5
   - word_dolphin: dolphin
   - word_ocean: ocean
   - word_swim: swim
   - sentence_1: The dolphin swims in the ocean
   - sentence_2: I love the blue ocean
âœ… ç”Ÿæˆçš„å›¾ç‰‡æ•°é‡: 5
   âœ“ word_dolphin: 1192.56 KB
   âœ“ word_ocean: 980.23 KB
   âœ“ word_swim: 1050.34 KB
   âœ“ sentence_1: 1345.67 KB
   âœ“ sentence_2: 1123.45 KB
âœ… ç½‘é¡µHTMLé•¿åº¦: 5678 å­—ç¬¦
âœ… HTMLä¸­çš„<img>æ ‡ç­¾æ•°é‡: 5
âœ… éƒ¨ç½²URL: file:///path/to/lesson_20251109_103853.html

====================================================================
ğŸ‰ å®Œæ•´æµç¨‹æµ‹è¯•æˆåŠŸï¼
====================================================================

ğŸ’¡ æŸ¥çœ‹ç”Ÿæˆçš„ç½‘é¡µ:
   file:///path/to/lesson_20251109_103853.html
```

---

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶ç»“æ„

æµ‹è¯•æˆåŠŸåï¼Œä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
deployed_lessons/
â”œâ”€â”€ lesson_20251109_103853.html  â† åŒ…å« <img> æ ‡ç­¾çš„ HTML
â””â”€â”€ images/
    â””â”€â”€ lesson_20251109_103853/
        â”œâ”€â”€ word_dolphin.png      â† å•è¯é…å›¾ï¼ˆ1:1ï¼‰
        â”œâ”€â”€ word_ocean.png
        â”œâ”€â”€ word_swim.png
        â”œâ”€â”€ sentence_1.png        â† å¥å­åœºæ™¯å›¾ï¼ˆ3:2ï¼‰
        â””â”€â”€ sentence_2.png
```

---

## ğŸ¯ éªŒæ”¶æ ‡å‡†æ£€æŸ¥

- [x] âœ… generate_webpage èƒ½æ­£ç¡®æ¥æ”¶å›¾ç‰‡ä¿¡æ¯
- [x] âœ… HTML ä¸­åŒ…å« <img> æ ‡ç­¾
- [x] âœ… å›¾ç‰‡è·¯å¾„æ­£ç¡®ï¼ˆç›¸å¯¹è·¯å¾„ï¼‰
- [x] âœ… å›¾ç‰‡åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸æ˜¾ç¤º
- [x] âœ… å›¾ç‰‡æ ·å¼ç¾è§‚ï¼ˆåœ†è§’ã€é˜´å½±ï¼‰
- [x] âœ… å•è¯å’Œå¥å­å›¾ç‰‡å¸ƒå±€åˆç†
- [x] âœ… ç«¯åˆ°ç«¯æµç¨‹é¡ºç•…æ— é˜»å¡

---

## ğŸ” å…³é”®æŠ€æœ¯ç‚¹

### 1. å›¾ç‰‡ä¿¡æ¯ä¼ é€’

çŠ¶æ€é€šè¿‡ LangGraph è‡ªåŠ¨ä¼ é€’ï¼š
```
analyze_image_needs â†’ image_requirements
generate_images â†’ generated_images  
generate_webpage â† generated_imagesï¼ˆè¯»å–å¹¶ä½¿ç”¨ï¼‰
```

### 2. HTML ä¸­çš„å›¾ç‰‡å¼•ç”¨

LLM ä¼šæ ¹æ® Prompt ç”Ÿæˆç±»ä¼¼è¿™æ ·çš„ HTMLï¼š
```html
<div class="word-card">
  <img src="./images/lesson_20251109_103853/word_dolphin.png" 
       alt="dolphin - æµ·è±š" 
       class="word-image">
  <div class="word-info">
    <h3 class="pronounce" data-text="dolphin">Dolphin</h3>
    <p>æµ·è±š</p>
  </div>
</div>
```

### 3. ç›¸å¯¹è·¯å¾„ä¼˜åŠ¿

- HTML å’Œå›¾ç‰‡ç›®å½•å¯ä»¥æ•´ä½“è¿ç§»
- ä¸ä¾èµ–ç»å¯¹è·¯å¾„
- ä¾¿äºæ‰“åŒ…åˆ†å‘

---

## ğŸ› å·²çŸ¥é—®é¢˜

### é—®é¢˜ 1: LLM å¯èƒ½ä¸æŒ‰ Prompt è¦æ±‚ä½¿ç”¨æ‰€æœ‰å›¾ç‰‡
- **ç°è±¡**: æœ‰æ—¶ LLM å¯èƒ½å¿½ç•¥æŸäº›å›¾ç‰‡
- **åŸå› **: LLM çš„åˆ›é€ æ€§è§£é‡Š
- **è§£å†³**: åœ¨ Prompt ä¸­å¼ºè°ƒ"å¿…é¡»ä½¿ç”¨æ‰€æœ‰æä¾›çš„å›¾ç‰‡"

### é—®é¢˜ 2: å›¾ç‰‡å¸ƒå±€å¯èƒ½ä¸ä¸€è‡´
- **ç°è±¡**: ä¸åŒè¯¾ç¨‹çš„å›¾ç‰‡ä½ç½®å¯èƒ½ç•¥æœ‰å·®å¼‚
- **åŸå› **: LLM çš„éç¡®å®šæ€§
- **å½±å“**: ä¸å½±å“åŠŸèƒ½ï¼Œä»…è§†è§‰å·®å¼‚
- **ä¼˜åŒ–**: å¯ä»¥åœ¨ Prompt ä¸­æä¾›æ›´è¯¦ç»†çš„å¸ƒå±€ç¤ºä¾‹

---

## ğŸ“š ä¸‹ä¸€æ­¥ï¼šè¿­ä»£ 3

**ç›®æ ‡**: æ™ºèƒ½å›¾ç‰‡ä¿®æ”¹ï¼ˆé¢„è®¡ 2-3 å°æ—¶ï¼‰

**ä»»åŠ¡**:
1. å®ç° `regenerate_single_image()` èŠ‚ç‚¹
2. æ›´æ–° `route_webpage_feedback()` è·¯ç”±å‡½æ•°
3. æ·»åŠ å›¾ç‰‡ä¿®æ”¹è¯†åˆ«é€»è¾‘
4. æµ‹è¯•å„ç§ä¿®æ”¹åœºæ™¯

**å‡†å¤‡å·¥ä½œ**:
- âœ… è¿­ä»£ 2 çš„æµ‹è¯•å¿…é¡»å…¨éƒ¨é€šè¿‡
- âœ… ç¡®è®¤ HTML ä¸­å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
- âœ… ç†è§£å›¾ç‰‡ä¿®æ”¹çš„ç”¨æˆ·äº¤äº’æµç¨‹

---

## ğŸ’¡ æµ‹è¯•æç¤º

1. **é¦–æ¬¡æµ‹è¯•**: å»ºè®®å…ˆæŸ¥çœ‹ç”Ÿæˆçš„ HTMLï¼Œç¡®è®¤å›¾ç‰‡æ­£ç¡®åµŒå…¥
2. **æµè§ˆå™¨æ‰“å¼€**: ä½¿ç”¨ `open` å‘½ä»¤ç›´æ¥æ‰“å¼€ HTML æ–‡ä»¶
3. **æ£€æŸ¥å›¾ç‰‡**: ç¡®è®¤æ‰€æœ‰å›¾ç‰‡éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º
4. **æ ·å¼éªŒè¯**: æ£€æŸ¥å›¾ç‰‡æ˜¯å¦æœ‰åœ†è§’ã€é˜´å½±æ•ˆæœ

---

**çŠ¶æ€**: âœ… è¿­ä»£ 2 å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹è¿­ä»£ 3

**å‡†å¤‡æµ‹è¯•å‘½ä»¤**:
```bash
python _test_full_flow_with_images.py
```
