# å›¾ç‰‡ç”ŸæˆåŠŸèƒ½éœ€æ±‚ä¸è®¾è®¡æ–‡æ¡£

- **æ–‡æ¡£ç‰ˆæœ¬**: 2.0
- **æ›´æ–°æ—¥æœŸ**: 2025-11-07
- **å…³è”æ–‡æ¡£**: [éœ€æ±‚æ–‡æ¡£ v1.0](./éœ€æ±‚æ–‡æ¡£.md), [ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ v1.0](./ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)
- **çŠ¶æ€**: âœ… éœ€æ±‚åˆ†æå®Œæˆï¼Œå¾…å®æ–½

---

## ç›®å½•

1. [å˜æ›´æ¦‚è¿°](#1-å˜æ›´æ¦‚è¿°)
2. [åŠŸèƒ½æ€§éœ€æ±‚](#2-åŠŸèƒ½æ€§éœ€æ±‚)
3. [æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡](#3-æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡)
4. [æµç¨‹è®¾è®¡](#4-æµç¨‹è®¾è®¡)
5. [æ•°æ®ç»“æ„è®¾è®¡](#5-æ•°æ®ç»“æ„è®¾è®¡)
6. [æˆæœ¬ä¸æ€§èƒ½åˆ†æ](#6-æˆæœ¬ä¸æ€§èƒ½åˆ†æ)
7. [å®æ–½è®¡åˆ’](#7-å®æ–½è®¡åˆ’)
8. [æµ‹è¯•ç”¨ä¾‹](#8-æµ‹è¯•ç”¨ä¾‹)
9. [é£é™©ä¸é™çº§ç­–ç•¥](#9-é£é™©ä¸é™çº§ç­–ç•¥)

---

## 1. å˜æ›´æ¦‚è¿°

### 1.1 èƒŒæ™¯

å½“å‰ç³»ç»Ÿï¼ˆv1.0ï¼‰å·²å®ç°ï¼š
- âœ… è¯¾ç¨‹å†…å®¹çš„è‡ªåŠ¨ç”Ÿæˆä¸å®¡æ ¸
- âœ… HTML ç½‘é¡µçš„è‡ªåŠ¨ç”Ÿæˆä¸éƒ¨ç½²
- âœ… å®Œæ•´çš„äººæœºäº¤äº’å¾ªç¯

å­˜åœ¨çš„é—®é¢˜ï¼š
- âŒ ç”Ÿæˆçš„ç½‘é¡µç¼ºå°‘è§†è§‰å…ƒç´ ï¼Œæ˜¾å¾—å‘†æ¿
- âŒ å¯¹å„¿ç«¥å­¦ä¹ è€…ç¼ºä¹è§†è§‰å¸å¼•åŠ›
- âŒ è¯æ±‡ç†è§£ç¼ºå°‘ç›´è§‚çš„å›¾åƒè¾…åŠ©

### 1.2 ç›®æ ‡

ä¸ºæ¯èŠ‚è‹±è¯­è¯¾è‡ªåŠ¨ç”Ÿæˆä¸å†…å®¹åŒ¹é…çš„é«˜è´¨é‡å›¾ç‰‡ï¼Œå®ç°ï¼š
- ğŸ¯ æ¯ä¸ªå­¦ä¹ å•è¯é…å¤‡ä¸€å¼ æ’å›¾
- ğŸ¯ æ¯ä¸ªå­¦ä¹ å¥å­é…å¤‡ä¸€å¼ åœºæ™¯å›¾
- ğŸ¯ ç”¨æˆ·å¯å®¡æ ¸å¹¶ç²¾ç¡®ä¿®æ”¹å•å¼ å›¾ç‰‡
- ğŸ¯ å›¾ç‰‡ä¸ç½‘é¡µæ— ç¼é›†æˆ

### 1.3 æ ¸å¿ƒä»·å€¼

- **å­¦ä¹ æ•ˆæœæå‡**: è§†è§‰è®°å¿†å¢å¼ºè¯æ±‡ç†è§£å’Œè®°å¿†
- **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**: æé«˜å„¿ç«¥å­¦ä¹ å…´è¶£å’Œå‚ä¸åº¦
- **å†…å®¹è´¨é‡**: è¾¾åˆ°ä¸“ä¸šå„¿ç«¥æ•™è‚²äº§å“çš„è§†è§‰æ ‡å‡†

---

## 2. åŠŸèƒ½æ€§éœ€æ±‚

### FR-IMG-1: æ™ºèƒ½å›¾ç‰‡éœ€æ±‚åˆ†æ

**FR-IMG-1.1** - å•è¯é…å›¾ç­–ç•¥
- **æè¿°**: ç³»ç»Ÿåº”è‡ªåŠ¨è¯†åˆ«è¯¾ç¨‹ä¸­æ‰€æœ‰å­¦ä¹ å•è¯ï¼Œå¹¶ä¸ºæ¯ä¸ªå•è¯ç”Ÿæˆä¸€å¼ é…å›¾
- **ç¤ºä¾‹**: è¯¾ç¨‹åŒ…å« "dolphin", "ocean", "swim" ä¸‰ä¸ªå•è¯ â†’ ç”Ÿæˆ 3 å¼ å•è¯æ’å›¾
- **ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰

**FR-IMG-1.2** - å¥å­åœºæ™¯å›¾ç­–ç•¥
- **æè¿°**: ç³»ç»Ÿåº”ä¸ºè¯¾ç¨‹ä¸­çš„é‡ç‚¹å­¦ä¹ å¥å­ç”Ÿæˆåœºæ™¯å›¾
- **ç¤ºä¾‹**: å¥å­ "The dolphin swims in the ocean" â†’ ç”Ÿæˆä¸€å¼ å®Œæ•´åœºæ™¯å›¾
- **æ•°é‡**: æ¯èŠ‚è¯¾ 2-3 ä¸ªå…³é”®å¥å­
- **ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰

**FR-IMG-1.3** - å›¾ç‰‡é£æ ¼è§„èŒƒ
- **å„¿ç«¥å‹å¥½**: å¡é€šé£æ ¼ã€è‰²å½©æ˜äº®ã€çº¿æ¡æŸ”å’Œ
- **æ•™è‚²æ€§**: æ¸…æ™°å±•ç¤ºæ¦‚å¿µï¼Œé¿å…å¹²æ‰°å…ƒç´ 
- **ä¸€è‡´æ€§**: åŒä¸€è¯¾ç¨‹å†…å›¾ç‰‡é£æ ¼ä¿æŒç»Ÿä¸€
- **ä¼˜å…ˆçº§**: P0ï¼ˆå¿…é¡»ï¼‰

### FR-IMG-2: å›¾ç‰‡ç”ŸæˆæŠ€æœ¯

**FR-IMG-2.1** - API é€‰æ‹©
- **æŠ€æœ¯**: Google Gemini 2.5 Flash Image API
- **ç†ç”±**: 
  - ä¸ç°æœ‰æŠ€æœ¯æ ˆï¼ˆGemini LLMï¼‰é›†æˆæœ€ç®€å•
  - æˆæœ¬ç›¸å¯¹è¾ƒä½ï¼ˆ$0.039/å¼ ï¼‰
  - æ”¯æŒå¯¹è¯å¼ç”Ÿæˆå’Œç¼–è¾‘
- **å‚è€ƒæ–‡æ¡£**: [Gemini Image Generation API](https://ai.google.dev/gemini-api/docs/image-generation)

**FR-IMG-2.2** - Prompt è‡ªåŠ¨ç”Ÿæˆ
- **è¾“å…¥**: ä¸­æ–‡å•è¯/å¥å­ + ä¸Šä¸‹æ–‡
- **è¾“å‡º**: é«˜è´¨é‡è‹±æ–‡å›¾ç‰‡ç”Ÿæˆ prompt
- **è¦æ±‚**: 
  - Prompt å¿…é¡»åŒ…å« "cartoon style", "bright colors", "educational", "for children"
  - é’ˆå¯¹å•è¯ï¼šä¾§é‡ç‰©ä½“/æ¦‚å¿µçš„æ¸…æ™°å±•ç¤º
  - é’ˆå¯¹å¥å­ï¼šä¾§é‡å®Œæ•´åœºæ™¯å’Œæƒ…å¢ƒ
- **ç¤ºä¾‹**:
  ```
  è¾“å…¥: å•è¯ "dolphin" (æµ·è±š)
  è¾“å‡º: "A friendly cartoon dolphin swimming in clear blue ocean water, 
         bright colors, educational illustration for children, simple background"
  ```

**FR-IMG-2.3** - å›¾ç‰‡å°ºå¯¸ä¸æ ¼å¼
- **å•è¯å›¾ç‰‡**: 1:1 æ¯”ä¾‹ (1024x1024px)
- **å¥å­å›¾ç‰‡**: 3:2 æ¯”ä¾‹ (1248x832px)
- **æ ¼å¼**: PNGï¼ˆæ”¯æŒé€æ˜èƒŒæ™¯ï¼‰
- **Alt æ–‡æœ¬**: è‡ªåŠ¨ç”Ÿæˆæè¿°æ€§ alt å±æ€§ï¼ˆæ— éšœç¢æ”¯æŒï¼‰

### FR-IMG-3: å­˜å‚¨ä¸éƒ¨ç½²

**FR-IMG-3.1** - ç›®å½•ç»“æ„
```
deployed_lessons/
â”œâ”€â”€ lesson_20251107_141530.html
â””â”€â”€ images/
    â””â”€â”€ lesson_20251107_141530/
        â”œâ”€â”€ word_dolphin.png
        â”œâ”€â”€ word_ocean.png
        â”œâ”€â”€ sentence_1.png
        â””â”€â”€ sentence_2.png
```

**FR-IMG-3.2** - HTML å¼•ç”¨æ–¹å¼
- **è·¯å¾„ç±»å‹**: ç›¸å¯¹è·¯å¾„ï¼ˆç›¸å¯¹äº HTML æ–‡ä»¶ï¼‰
- **ç¤ºä¾‹**: `<img src="./images/lesson_20251107_141530/word_dolphin.png" alt="æµ·è±š - Dolphin">`
- **ä¼˜åŠ¿**: ä¾¿äºæ•´ä¸ªè¯¾ç¨‹ç›®å½•çš„æ‰“åŒ…å’Œè¿ç§»

**FR-IMG-3.3** - éƒ¨ç½²åŸå­æ€§
- **è¦æ±‚**: HTML å’Œå›¾ç‰‡ç›®å½•å¿…é¡»åŒæ—¶éƒ¨ç½²æˆåŠŸ
- **å¤±è´¥å¤„ç†**: å¦‚éƒ¨åˆ†å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œåº”è®°å½•å¹¶é€šçŸ¥ç”¨æˆ·ï¼Œä½†ä¸åº”é˜»æ–­æµç¨‹

### FR-IMG-4: ç”¨æˆ·äº¤äº’ä¸å®¡æ ¸

**FR-IMG-4.1** - å®¡æ ¸æ—¶æœº
- **æ—¶æœº**: å›¾ç‰‡åœ¨ç½‘é¡µå®¡æ ¸é˜¶æ®µä¸ HTML ä¸€èµ·å‘ˆç°ç»™ç”¨æˆ·
- **å±•ç¤º**: ç”¨æˆ·é€šè¿‡è®¿é—®éƒ¨ç½²çš„ HTML æŸ¥çœ‹å›¾ç‰‡æ•ˆæœ
- **åˆ†ç¦»å®¡æ ¸**: ä¸å•ç‹¬å®¡æ ¸å›¾ç‰‡ï¼Œä¸ç½‘é¡µæ•´ä½“å®¡æ ¸åˆå¹¶

**FR-IMG-4.2** - å›¾ç‰‡ä¿®æ”¹æ”¯æŒ
- **å•å¼ ç²¾ç¡®ä¿®æ”¹**: ç”¨æˆ·å¯ä»¥æŒ‡å®šä¿®æ”¹æŸä¸€å¼ å›¾ç‰‡
  ```
  ç”¨æˆ·åé¦ˆç¤ºä¾‹: "æµ·è±šçš„å›¾ç‰‡èƒŒæ™¯æ”¹æˆæ·±è“è‰²"
  ç³»ç»Ÿè¡Œä¸º: è¯†åˆ«ç›®æ ‡å›¾ç‰‡ â†’ ç”Ÿæˆæ–° prompt â†’ é‡æ–°ç”Ÿæˆè¯¥å›¾ç‰‡ â†’ æ›´æ–°ç½‘é¡µ
  ```

**FR-IMG-4.3** - ä¿®æ”¹ç±»å‹è¯†åˆ«
ç³»ç»Ÿåº”èƒ½åŒºåˆ†ä¸‰ç§åé¦ˆç±»å‹ï¼š
1. **æ‰¹å‡†**: "æ»¡æ„"ã€"å¯ä»¥"ã€"æ²¡é—®é¢˜" â†’ æµç¨‹ç»“æŸ
2. **ä¿®æ”¹å›¾ç‰‡**: åé¦ˆä¸­åŒ…å«"å›¾ç‰‡"ã€"å›¾"ç­‰å…³é”®è¯ â†’ è§¦å‘å›¾ç‰‡é‡æ–°ç”Ÿæˆ
3. **ä¿®æ”¹ç½‘é¡µ**: å…¶ä»–ä¿®æ”¹æ„è§ â†’ é‡æ–°ç”Ÿæˆ HTMLï¼ˆå›¾ç‰‡ä¸å˜ï¼‰

**FR-IMG-4.4** - ä¿®æ”¹èŒƒå›´æ§åˆ¶
- ä¿®æ”¹æŸå¼ å›¾ç‰‡æ—¶ï¼Œå…¶ä»–å›¾ç‰‡ä¿æŒä¸å˜
- å›¾ç‰‡ä¿®æ”¹åï¼ŒHTML è‡ªåŠ¨æ›´æ–°å›¾ç‰‡å¼•ç”¨ï¼ˆè·¯å¾„å¯èƒ½å˜åŒ–ï¼‰
- ä¿ç•™å†å²ç‰ˆæœ¬ï¼Œä¸è¦†ç›–åŸæ–‡ä»¶ï¼ˆé€šè¿‡æ—¶é—´æˆ³åŒºåˆ†ï¼‰

### FR-IMG-5: æµç¨‹é›†æˆ

**FR-IMG-5.1** - ç”Ÿæˆæ—¶æœº
- **é¡ºåº**: è¯¾ç¨‹å†…å®¹ç¡®è®¤ â†’ åˆ†æå›¾ç‰‡éœ€æ±‚ â†’ ç”Ÿæˆå›¾ç‰‡ â†’ ç”Ÿæˆç½‘é¡µ â†’ éƒ¨ç½²
- **ç†ç”±**: å…ˆç”Ÿæˆå›¾ç‰‡ï¼Œè®© LLM åœ¨ç”Ÿæˆç½‘é¡µæ—¶èƒ½æ ¹æ®å›¾ç‰‡æ•°é‡å’Œå†…å®¹ä¼˜åŒ–å¸ƒå±€

**FR-IMG-5.2** - çŠ¶æ€ä¼ é€’
- å›¾ç‰‡ç”Ÿæˆç»“æœï¼ˆè·¯å¾„ã€æè¿°ï¼‰å¿…é¡»ä¼ é€’ç»™ç½‘é¡µç”ŸæˆèŠ‚ç‚¹
- ç½‘é¡µç”ŸæˆèŠ‚ç‚¹æ ¹æ®å›¾ç‰‡ä¿¡æ¯è°ƒæ•´ HTML ç»“æ„

**FR-IMG-5.3** - é”™è¯¯å¤„ç†
- **é™çº§ç­–ç•¥**: å¦‚å›¾ç‰‡ç”Ÿæˆå…¨éƒ¨å¤±è´¥ï¼Œä»ç”Ÿæˆä¸å«å›¾ç‰‡çš„ç½‘é¡µ
- **éƒ¨åˆ†å¤±è´¥**: å¦‚éƒ¨åˆ†å›¾ç‰‡å¤±è´¥ï¼Œä½¿ç”¨å ä½ç¬¦æˆ–è·³è¿‡è¯¥å›¾ç‰‡
- **ç”¨æˆ·é€šçŸ¥**: æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·å“ªäº›å›¾ç‰‡ç”Ÿæˆå¤±è´¥

---

## 3. æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡

### 3.1 æŠ€æœ¯æ ˆæ›´æ–°

#### æ–°å¢ä¾èµ–
```python
# requirements.txt
google-genai>=1.0.0      # Google Gemini SDKï¼ˆæ”¯æŒå›¾ç‰‡ç”Ÿæˆï¼‰
Pillow>=10.0.0           # å›¾åƒå¤„ç†ï¼ˆå·²æœ‰ï¼‰
```

#### API é›†æˆæ–¹å¼
```python
from google import genai
from google.genai import types

client = genai.Client()

response = client.models.generate_content(
    model="gemini-2.5-flash-image",
    contents=[prompt],
    config=types.GenerateContentConfig(
        image_config=types.ImageConfig(
            aspect_ratio="1:1"
        )
    )
)
```

### 3.2 æ¨¡å—åˆ’åˆ†

#### æ–°å¢å·¥å…·å‡½æ•° (`src/tools.py`)
- `generate_image_with_gemini()`: è°ƒç”¨ Gemini API ç”Ÿæˆå•å¼ å›¾ç‰‡
- `save_image_to_disk()`: ä¿å­˜å›¾ç‰‡åˆ°æ–‡ä»¶ç³»ç»Ÿ
- `create_image_directory()`: åˆ›å»ºè¯¾ç¨‹å›¾ç‰‡ç›®å½•

#### æ–°å¢èŠ‚ç‚¹å‡½æ•° (`src/nodes.py`)
- `analyze_image_needs()`: åˆ†æè¯¾ç¨‹å†…å®¹ï¼Œæå–å›¾ç‰‡éœ€æ±‚
- `generate_images()`: æ‰¹é‡ç”Ÿæˆå›¾ç‰‡
- `regenerate_single_image()`: é‡æ–°ç”Ÿæˆå•å¼ å›¾ç‰‡

#### æ›´æ–°ç°æœ‰å‡½æ•°
- `generate_webpage()`: æ¥æ”¶å›¾ç‰‡ä¿¡æ¯ï¼Œç”ŸæˆåŒ…å«å›¾ç‰‡çš„ HTML
- `deploy_webpage()`: åŒæ—¶éƒ¨ç½² HTML å’Œå›¾ç‰‡ç›®å½•

### 3.3 å…³é”®æŠ€æœ¯å†³ç­–

#### å†³ç­– 1: ä¸ºä»€ä¹ˆä½¿ç”¨ Gemini è€Œé DALL-Eï¼Ÿ
| ç»´åº¦ | Gemini 2.5 Flash Image | DALL-E 3 |
|------|------------------------|----------|
| é›†æˆå¤æ‚åº¦ | âœ… å·²æœ‰ API Key | âš ï¸ éœ€è¦ OpenAI è´¦å· |
| æˆæœ¬ | âœ… $0.039/å¼  | âš ï¸ $0.04-0.08/å¼  |
| ç”Ÿæˆé€Ÿåº¦ | âœ… å¿« | âš ï¸ è¾ƒæ…¢ |
| å¯¹è¯å¼ç¼–è¾‘ | âœ… åŸç”Ÿæ”¯æŒ | âŒ ä¸æ”¯æŒ |
| å„¿ç«¥æ’ç”»è´¨é‡ | âœ… ä¼˜ç§€ | âœ… ä¼˜ç§€ |

**ç»“è®º**: Gemini æ˜¯å½“å‰æœ€ä¼˜é€‰æ‹©

#### å†³ç­– 2: å…ˆç”Ÿæˆå›¾ç‰‡è¿˜æ˜¯å…ˆç”Ÿæˆç½‘é¡µï¼Ÿ
**é€‰æ‹©**: å…ˆç”Ÿæˆå›¾ç‰‡ï¼Œå†ç”Ÿæˆç½‘é¡µ

**ç†ç”±**:
- âœ… LLM ç”Ÿæˆç½‘é¡µæ—¶èƒ½"çŸ¥é“"æœ‰å“ªäº›å›¾ç‰‡ï¼Œå¸ƒå±€æ›´åˆç†
- âœ… å›¾ç‰‡æè¿°ï¼ˆalt textï¼‰å¯ä»¥æ›´å‡†ç¡®
- âœ… æµç¨‹é€»è¾‘æ›´æ¸…æ™°ï¼šå†…å®¹ â†’ ç´ æ â†’ å‘ˆç°
- âœ… é¿å…ç½‘é¡µç”Ÿæˆåå‘ç°å›¾ç‰‡ä¸åŒ¹é…éœ€è¦å›é€€

**ä»£ä»·**:
- âš ï¸ å›¾ç‰‡ç”Ÿæˆè€—æ—¶è¾ƒé•¿ï¼ˆæ¯å¼ çº¦ 3-5 ç§’ï¼‰
- âš ï¸ éœ€è¦å¤„ç†å›¾ç‰‡ç”Ÿæˆå¤±è´¥çš„é™çº§é€»è¾‘

#### å†³ç­– 3: å›¾ç‰‡å­˜å‚¨æ–¹å¼
**é€‰æ‹©**: ç‹¬ç«‹æ–‡ä»¶ + ç›¸å¯¹è·¯å¾„å¼•ç”¨

**å¤‡é€‰æ–¹æ¡ˆå¯¹æ¯”**:
| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ˜¯å¦é‡‡ç”¨ |
|------|------|------|----------|
| Base64 å†…åµŒ | å•æ–‡ä»¶éƒ¨ç½²ç®€å• | æ–‡ä»¶å·¨å¤§ã€ä¸ä¾¿ç¼“å­˜ | âŒ |
| ç‹¬ç«‹æ–‡ä»¶ | ä¾¿äºç®¡ç†ã€æ”¯æŒç¼“å­˜ | éœ€è¦åŒæ—¶éƒ¨ç½²å¤šä¸ªæ–‡ä»¶ | âœ… |
| CDN æ‰˜ç®¡ | åŠ è½½å¿«ã€èŠ‚çœç©ºé—´ | éœ€è¦é¢å¤–æœåŠ¡ã€æˆæœ¬é«˜ | âŒï¼ˆæœªæ¥è€ƒè™‘ï¼‰|

---

## 4. æµç¨‹è®¾è®¡

### 4.1 LangGraph èŠ‚ç‚¹æ›´æ–°

#### æ–°å¢èŠ‚ç‚¹

**èŠ‚ç‚¹ 1: `analyze_image_needs`**
- **è¾“å…¥**: `final_lesson_content`ï¼ˆå·²ç¡®è®¤çš„è¯¾ç¨‹å†…å®¹ï¼‰
- **å¤„ç†**: 
  1. ä½¿ç”¨ LLM åˆ†æè¯¾ç¨‹å†…å®¹
  2. æå–æ‰€æœ‰å­¦ä¹ å•è¯
  3. æå– 2-3 ä¸ªå…³é”®å¥å­
  4. ä¸ºæ¯ä¸ªå…ƒç´ ç”Ÿæˆè‹±æ–‡ image prompt
- **è¾“å‡º**: 
  - `image_requirements`: List[ImageRequirement]
  - `lesson_id`: è¯¾ç¨‹å”¯ä¸€æ ‡è¯†ï¼ˆæ—¶é—´æˆ³ï¼‰

**èŠ‚ç‚¹ 2: `generate_images`**
- **è¾“å…¥**: `image_requirements`, `lesson_id`
- **å¤„ç†**:
  1. éå† `image_requirements`
  2. è°ƒç”¨ Gemini Image API ç”Ÿæˆæ¯å¼ å›¾ç‰‡
  3. ä¿å­˜åˆ° `deployed_lessons/images/lesson_{id}/`
  4. è®°å½•æˆåŠŸ/å¤±è´¥çŠ¶æ€
- **è¾“å‡º**: `generated_images`: List[GeneratedImage]

**èŠ‚ç‚¹ 3: `regenerate_single_image`**
- **è¾“å…¥**: `user_feedback`, `generated_images`, `image_requirements`
- **å¤„ç†**:
  1. ä½¿ç”¨ LLM åˆ†æç”¨æˆ·åé¦ˆï¼Œè¯†åˆ«ç›®æ ‡å›¾ç‰‡
  2. æå–ä¿®æ”¹è¦æ±‚ï¼Œç”Ÿæˆæ–° prompt
  3. é‡æ–°ç”Ÿæˆè¯¥å›¾ç‰‡
  4. æ›´æ–° `generated_images` åˆ—è¡¨
- **è¾“å‡º**: `generated_images`: List[GeneratedImage]ï¼ˆæ›´æ–°åï¼‰

#### æ›´æ–°ç°æœ‰èŠ‚ç‚¹

**èŠ‚ç‚¹: `generate_webpage`**
- **æ–°å¢è¾“å…¥**: `generated_images`
- **å˜æ›´**: Prompt ä¸­åŒ…å«å›¾ç‰‡ä¿¡æ¯ï¼ŒæŒ‡å¯¼ LLM ç”ŸæˆåŒ…å« `<img>` æ ‡ç­¾çš„ HTML

**èŠ‚ç‚¹: `deploy_webpage_node`**
- **å˜æ›´**: åŒæ—¶è¿”å› HTML è·¯å¾„å’Œå›¾ç‰‡ç›®å½•è·¯å¾„
- **éªŒè¯**: ç¡®è®¤æ‰€æœ‰å¼•ç”¨çš„å›¾ç‰‡æ–‡ä»¶éƒ½å­˜åœ¨

### 4.2 æµç¨‹å›¾ï¼ˆå®Œæ•´ç‰ˆï¼‰

```
START
  â†“
load_framework
  â†“
generate_initial_draft
  â†“
[ä¸­æ–­1 - ç­‰å¾…è¯¾ç¨‹å†…å®¹å®¡æ ¸]
  â†“
ç”¨æˆ·åé¦ˆè·¯ç”±
  â”œâ”€ approve â†’ finalize_content
  â””â”€ revise â†’ revise_draft â”
                           â”‚
                           â””â”€â†’ [å¾ªç¯å›ä¸­æ–­1]
  â†“
finalize_content
  â†“
analyze_image_needs  â† ã€æ–°å¢ã€‘åˆ†æå›¾ç‰‡éœ€æ±‚
  â†“                    LLM æå–å•è¯å’Œå¥å­
  â†“                    ç”Ÿæˆè‹±æ–‡ prompts
generate_images      â† ã€æ–°å¢ã€‘æ‰¹é‡ç”Ÿæˆå›¾ç‰‡
  â†“                    è°ƒç”¨ Gemini Image API
  â†“                    ä¿å­˜åˆ°æœ¬åœ°ç›®å½•
generate_webpage       ï¼ˆæ›´æ–°ï¼šæ¥æ”¶å›¾ç‰‡ä¿¡æ¯ï¼‰
  â†“                    ç”ŸæˆåŒ…å« <img> æ ‡ç­¾çš„ HTML
deploy_webpage_node    ï¼ˆæ›´æ–°ï¼šéƒ¨ç½² HTML + å›¾ç‰‡ï¼‰
  â†“
[ä¸­æ–­2 - ç­‰å¾…ç½‘é¡µ+å›¾ç‰‡å®¡æ ¸]
  â†“
ç”¨æˆ·åé¦ˆè·¯ç”±ï¼ˆå¢å¼ºç‰ˆï¼‰
  â”œâ”€ approve â†’ END
  â”œâ”€ ä¿®æ”¹å›¾ç‰‡ â†’ regenerate_single_image â”
  â”‚                                      â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚  â†“
  â”‚  generate_webpage  ï¼ˆå›¾ç‰‡ä¿®æ”¹åé‡æ–°ç”Ÿæˆç½‘é¡µï¼‰
  â”‚  â†“
  â”‚  deploy_webpage_node
  â”‚  â†“
  â”‚  [å¾ªç¯å›ä¸­æ–­2]
  â”‚
  â””â”€ ä¿®æ”¹ç½‘é¡µ â†’ generate_webpage â”
                                 â”‚
                                 â””â”€â†’ deploy_webpage_node
                                       â†“
                                     [å¾ªç¯å›ä¸­æ–­2]
```

### 4.3 æ¡ä»¶è·¯ç”±é€»è¾‘

#### è·¯ç”±å‡½æ•°: `route_webpage_feedback`ï¼ˆå¢å¼ºç‰ˆï¼‰

```python
def route_webpage_feedback(state: CourseGenerationState) -> str:
    """
    è¯†åˆ«ç”¨æˆ·åé¦ˆç±»å‹ï¼Œå†³å®šä¸‹ä¸€æ­¥æ“ä½œ
    """
    feedback = state["user_feedback"].lower()
    
    # 1. æ£€æµ‹æ‰¹å‡†
    approve_keywords = ["åŒæ„", "approve", "ç¡®è®¤", "æ²¡é—®é¢˜", "å¯ä»¥", "æ»¡æ„", "å¾ˆå¥½"]
    if any(keyword in feedback for keyword in approve_keywords):
        return "end"
    
    # 2. æ£€æµ‹å›¾ç‰‡ä¿®æ”¹è¯·æ±‚
    image_keywords = ["å›¾ç‰‡", "å›¾", "picture", "image", "ç…§ç‰‡"]
    if any(keyword in feedback for keyword in image_keywords):
        return "regenerate_image"
    
    # 3. é»˜è®¤ï¼šç½‘é¡µæ•´ä½“ä¿®æ”¹
    return "regenerate_webpage"
```

**è·¯ç”±è¾“å‡ºæ˜ å°„**:
- `"end"` â†’ `END`ï¼ˆæµç¨‹ç»“æŸï¼‰
- `"regenerate_image"` â†’ `regenerate_single_image`ï¼ˆé‡æ–°ç”Ÿæˆå•å¼ å›¾ç‰‡ï¼‰
- `"regenerate_webpage"` â†’ `generate_webpage`ï¼ˆé‡æ–°ç”Ÿæˆç½‘é¡µï¼‰

---

## 5. æ•°æ®ç»“æ„è®¾è®¡

### 5.1 çŠ¶æ€å¯¹è±¡æ›´æ–°

```python
# src/state.py

from typing import List, TypedDict, Annotated, Dict
from langchain_core.messages import BaseMessage
from langgraph.graph.message import add_messages

class ImageRequirement(TypedDict):
    """å›¾ç‰‡éœ€æ±‚å®šä¹‰"""
    id: str              # å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ "word_dolphin", "sentence_1"
    type: str            # "word" æˆ– "sentence"
    content: str         # å•è¯æˆ–å¥å­çš„è‹±æ–‡åŸæ–‡
    description: str     # ä¸­æ–‡æè¿°
    prompt_en: str       # è‹±æ–‡å›¾ç‰‡ç”Ÿæˆ prompt

class GeneratedImage(TypedDict):
    """å·²ç”Ÿæˆçš„å›¾ç‰‡ä¿¡æ¯"""
    id: str              # å¯¹åº” ImageRequirement çš„ id
    file_path: str       # HTML ä¸­ä½¿ç”¨çš„ç›¸å¯¹è·¯å¾„
    absolute_path: str   # æ–‡ä»¶ç³»ç»Ÿç»å¯¹è·¯å¾„
    alt_text: str        # HTML alt å±æ€§å€¼

class CourseGenerationState(TypedDict):
    # ===== åŸæœ‰å­—æ®µ =====
    theme: str
    user_feedback: str
    curriculum_framework: str
    lesson_draft: str
    final_lesson_content: str
    webpage_html: str
    deployment_url: str
    messages: Annotated[List[BaseMessage], add_messages]
    
    # ===== æ–°å¢å­—æ®µ =====
    lesson_id: str                              # è¯¾ç¨‹å”¯ä¸€æ ‡è¯†ï¼ˆæ—¶é—´æˆ³ï¼‰
    image_requirements: List[ImageRequirement]  # å›¾ç‰‡éœ€æ±‚åˆ—è¡¨
    generated_images: List[GeneratedImage]      # å·²ç”Ÿæˆçš„å›¾ç‰‡åˆ—è¡¨
```

### 5.2 æ•°æ®æµç¤ºä¾‹

#### ç¤ºä¾‹è¯¾ç¨‹: "æµ·æ´‹åŠ¨ç‰©"

**Step 1: analyze_image_needs è¾“å‡º**
```json
{
  "lesson_id": "20251107_141530",
  "image_requirements": [
    {
      "id": "word_dolphin",
      "type": "word",
      "content": "dolphin",
      "description": "æµ·è±š",
      "prompt_en": "A friendly cartoon dolphin swimming in clear blue ocean water, bright colors, educational illustration for children, simple background"
    },
    {
      "id": "word_ocean",
      "type": "word",
      "content": "ocean",
      "description": "æµ·æ´‹",
      "prompt_en": "A beautiful blue ocean with gentle waves, bright sunny day, cartoon style, educational illustration for children"
    },
    {
      "id": "sentence_1",
      "type": "sentence",
      "content": "The dolphin swims in the ocean",
      "description": "æµ·è±šåœ¨æµ·æ´‹ä¸­æ¸¸æ³³",
      "prompt_en": "A cheerful dolphin swimming gracefully in the ocean, with sunlight streaming through the water, colorful fish around, cartoon style for kids"
    }
  ]
}
```

**Step 2: generate_images è¾“å‡º**
```json
{
  "generated_images": [
    {
      "id": "word_dolphin",
      "file_path": "./images/lesson_20251107_141530/word_dolphin.png",
      "absolute_path": "/Users/shushu/.../deployed_lessons/images/lesson_20251107_141530/word_dolphin.png",
      "alt_text": "dolphin - æµ·è±š"
    },
    {
      "id": "word_ocean",
      "file_path": "./images/lesson_20251107_141530/word_ocean.png",
      "absolute_path": "/Users/shushu/.../deployed_lessons/images/lesson_20251107_141530/word_ocean.png",
      "alt_text": "ocean - æµ·æ´‹"
    },
    {
      "id": "sentence_1",
      "file_path": "./images/lesson_20251107_141530/sentence_1.png",
      "absolute_path": "/Users/shushu/.../deployed_lessons/images/lesson_20251107_141530/sentence_1.png",
      "alt_text": "The dolphin swims in the ocean - æµ·è±šåœ¨æµ·æ´‹ä¸­æ¸¸æ³³"
    }
  ]
}
```

---

## 6. æˆæœ¬ä¸æ€§èƒ½åˆ†æ

### 6.1 æˆæœ¬ä¼°ç®—

#### API è°ƒç”¨æˆæœ¬

åŸºäº [Gemini å®šä»·æ–‡æ¡£](https://ai.google.dev/gemini-api/docs/image-generation):

| é¡¹ç›® | Token æ¶ˆè€— | å•ä»· | å•å¼ æˆæœ¬ |
|------|-----------|------|---------|
| å›¾ç‰‡ç”Ÿæˆï¼ˆ1024x1024ï¼‰ | 1290 tokens | $30/ç™¾ä¸‡ tokens | **$0.0387** |
| å›¾ç‰‡ç”Ÿæˆï¼ˆ1248x832ï¼‰ | 1290 tokens | $30/ç™¾ä¸‡ tokens | **$0.0387** |

#### å…¸å‹è¯¾ç¨‹æˆæœ¬

**å‡è®¾**:
- æ¯èŠ‚è¯¾ 5 ä¸ªå•è¯ + 2 ä¸ªå¥å­ = 7 å¼ å›¾ç‰‡

**è®¡ç®—**:
```
å•èŠ‚è¯¾å›¾ç‰‡æˆæœ¬ = 7 Ã— $0.0387 â‰ˆ $0.27
```

**æœˆåº¦æˆæœ¬**ï¼ˆæ¯å¤© 1 èŠ‚è¯¾ï¼‰:
```
æœˆåº¦æˆæœ¬ = 30 Ã— $0.27 â‰ˆ $8.10
å¹´åº¦æˆæœ¬ = 365 Ã— $0.27 â‰ˆ $98.55
```

#### å¯¹æ¯”åˆ†æ

| æ–¹æ¡ˆ | å•å¼ æˆæœ¬ | æœˆåº¦æˆæœ¬ï¼ˆ7å›¾/å¤©ï¼‰ |
|------|---------|------------------|
| **Gemini 2.5 Flash** | $0.039 | **$8.10** |
| DALL-E 3 Standard | $0.040 | $8.40 |
| DALL-E 3 HD | $0.080 | $16.80 |
| Midjourney Pro | - | $30/æœˆï¼ˆæ— é™é‡ï¼‰|

**ç»“è®º**: Gemini å…·å¤‡æˆæœ¬ä¼˜åŠ¿

### 6.2 æ€§èƒ½åˆ†æ

#### æ—¶é—´æ¶ˆè€—ä¼°ç®—

| æ­¥éª¤ | è€—æ—¶ | å¤‡æ³¨ |
|------|------|------|
| analyze_image_needs | 5-10s | LLM åˆ†æ + JSON è§£æ |
| generate_images (7å¼ ) | 21-35s | å•å¼  3-5s Ã— 7 |
| generate_webpage | 10-15s | LLM ç”Ÿæˆ HTML |
| deploy_webpage | 1-2s | æ–‡ä»¶ç³»ç»Ÿå†™å…¥ |
| **æ€»è®¡** | **37-62s** | çº¦ 40-60 ç§’ |

**å¯¹æ¯” v1.0**ï¼ˆæ— å›¾ç‰‡ï¼‰:
- v1.0: ç½‘é¡µç”Ÿæˆ + éƒ¨ç½² â‰ˆ 15s
- v2.0: +40-60s å›¾ç‰‡ç”Ÿæˆ
- **æ€»å»¶é•¿**: çº¦ 3-4 å€

#### ä¼˜åŒ–ç­–ç•¥

1. **å¹¶è¡Œç”Ÿæˆ**: å›¾ç‰‡ç”Ÿæˆå¯å¹¶è¡ŒåŒ–ï¼ˆéœ€è€ƒè™‘ API é€Ÿç‡é™åˆ¶ï¼‰
2. **ç¼“å­˜å¤ç”¨**: å¸¸è§å•è¯ï¼ˆå¦‚ "hello"ï¼‰çš„å›¾ç‰‡å¯ç¼“å­˜
3. **æŒ‰éœ€ç”Ÿæˆ**: ç”¨æˆ·å¯é€‰æ‹©"å¿«é€Ÿæ¨¡å¼"ï¼ˆæ— å›¾ç‰‡ï¼‰æˆ–"å®Œæ•´æ¨¡å¼"ï¼ˆæœ‰å›¾ç‰‡ï¼‰

---

## 7. å®æ–½è®¡åˆ’

### è¿­ä»£ 1: åŸºç¡€å›¾ç‰‡ç”Ÿæˆï¼ˆé¢„è®¡ 2-3 å°æ—¶ï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] æ›´æ–° `requirements.txt`ï¼Œæ·»åŠ  `google-genai`
- [ ] æ›´æ–° `src/state.py`ï¼Œæ·»åŠ  `ImageRequirement`, `GeneratedImage`, ä»¥åŠçŠ¶æ€å­—æ®µ
- [ ] åœ¨ `src/tools.py` ä¸­å®ç° `generate_image_with_gemini()`
- [ ] åœ¨ `src/nodes.py` ä¸­å®ç° `analyze_image_needs()`
- [ ] åœ¨ `src/nodes.py` ä¸­å®ç° `generate_images()`
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•ï¼ŒéªŒè¯ API è°ƒç”¨å’Œå›¾ç‰‡ä¿å­˜

**éªŒæ”¶æ ‡å‡†**:
- âœ… èƒ½æˆåŠŸè°ƒç”¨ Gemini Image API
- âœ… å›¾ç‰‡æ­£ç¡®ä¿å­˜åˆ°æ–‡ä»¶ç³»ç»Ÿ
- âœ… `analyze_image_needs` æ­£ç¡®æå–å•è¯å’Œå¥å­

### è¿­ä»£ 2: ç½‘é¡µé›†æˆï¼ˆé¢„è®¡ 2 å°æ—¶ï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] æ›´æ–° `src/nodes.py` ä¸­çš„ `generate_webpage()`ï¼Œæ¥æ”¶å›¾ç‰‡ä¿¡æ¯
- [ ] ä¿®æ”¹ç½‘é¡µç”Ÿæˆ Promptï¼ŒåŒ…å«å›¾ç‰‡å¼•ç”¨æŒ‡ä»¤
- [ ] æ›´æ–° `src/tools.py` ä¸­çš„ `deploy_webpage()`ï¼Œç¡®ä¿å›¾ç‰‡ç›®å½•ä¸€å¹¶éƒ¨ç½²
- [ ] æ›´æ–° `src/graph.py`ï¼Œæ·»åŠ å›¾ç‰‡ç›¸å…³èŠ‚ç‚¹å’Œè¾¹
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•ï¼šè¯¾ç¨‹å†…å®¹ â†’ å›¾ç‰‡ç”Ÿæˆ â†’ ç½‘é¡µç”Ÿæˆ â†’ éƒ¨ç½²

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç”Ÿæˆçš„ HTML æ­£ç¡®å¼•ç”¨å›¾ç‰‡
- âœ… å›¾ç‰‡åœ¨æµè§ˆå™¨ä¸­æ­£å¸¸æ˜¾ç¤º
- âœ… HTML å¸ƒå±€ç¾è§‚ï¼ˆå•è¯å¡ç‰‡ã€å¥å­åœºæ™¯ï¼‰

### è¿­ä»£ 3: æ™ºèƒ½ä¿®æ”¹ï¼ˆé¢„è®¡ 2-3 å°æ—¶ï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] åœ¨ `src/nodes.py` ä¸­å®ç° `regenerate_single_image()`
- [ ] æ›´æ–° `src/graph.py` ä¸­çš„ `route_webpage_feedback()`ï¼Œå¢åŠ å›¾ç‰‡ä¿®æ”¹è¯†åˆ«
- [ ] æ·»åŠ æ¡ä»¶è¾¹ï¼š`deploy_webpage_node` â†’ `regenerate_single_image`
- [ ] åœ¨ `src/bot.py` ä¸­ä¼˜åŒ–æ¶ˆæ¯æç¤ºï¼Œå‘ŠçŸ¥ç”¨æˆ·å¯ä»¥ä¿®æ”¹å›¾ç‰‡
- [ ] æµ‹è¯•å„ç§ä¿®æ”¹åœºæ™¯ï¼ˆä¿®æ”¹å•å›¾ã€ä¿®æ”¹ç½‘é¡µã€æ‰¹å‡†ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç”¨æˆ·è¯´"æµ·è±šå›¾ç‰‡æ”¹æˆè“è‰²"èƒ½æ­£ç¡®è¯†åˆ«å¹¶é‡æ–°ç”Ÿæˆ
- âœ… ä¿®æ”¹åå…¶ä»–å›¾ç‰‡ä¿æŒä¸å˜
- âœ… ç½‘é¡µè‡ªåŠ¨æ›´æ–°å›¾ç‰‡å¼•ç”¨

### è¿­ä»£ 4: ä¼˜åŒ–ä¸æ–‡æ¡£ï¼ˆé¢„è®¡ 1 å°æ—¶ï¼‰

**ä»»åŠ¡æ¸…å•**:
- [ ] æ·»åŠ é”™è¯¯å¤„ç†å’Œé™çº§é€»è¾‘
- [ ] ä¼˜åŒ– Prompt è´¨é‡ï¼ˆå¤šæ¬¡æµ‹è¯•è°ƒæ•´ï¼‰
- [ ] æ›´æ–° `README.md`
- [ ] ç¼–å†™æ“ä½œæŒ‡å—ï¼ˆå¦‚ä½•ä¿®æ”¹å›¾ç‰‡ï¼‰
- [ ] æ€§èƒ½ç›‘æ§å’Œæ—¥å¿—å®Œå–„

**éªŒæ”¶æ ‡å‡†**:
- âœ… å›¾ç‰‡ç”Ÿæˆå¤±è´¥æ—¶æœ‰å‹å¥½æç¤º
- âœ… æ–‡æ¡£å®Œæ•´ï¼Œä»–äººå¯ä¾æ®æ–‡æ¡£ä½¿ç”¨ç³»ç»Ÿ

---

## 8. æµ‹è¯•ç”¨ä¾‹

### 8.1 å•å…ƒæµ‹è¯•

#### Test 1: API è¿æ¥æµ‹è¯•
```python
def test_gemini_image_api_connection():
    """éªŒè¯ Gemini Image API å¯æ­£å¸¸è°ƒç”¨"""
    prompt = "A simple cartoon apple, bright red color, educational illustration"
    result = generate_image_with_gemini(
        prompt=prompt,
        image_id="test_apple",
        lesson_id="test_001"
    )
    assert result["success"] == True
    assert os.path.exists(result["absolute_path"])
```

#### Test 2: å›¾ç‰‡éœ€æ±‚åˆ†æ
```python
def test_analyze_image_needs():
    """éªŒè¯èƒ½æ­£ç¡®æå–å•è¯å’Œå¥å­"""
    state = {
        "final_lesson_content": """
        # ä»Šæ—¥å•è¯
        - dolphin (æµ·è±š)
        - ocean (æµ·æ´‹)
        
        # ä¾‹å¥
        1. The dolphin swims in the ocean.
        """
    }
    result = analyze_image_needs(state)
    assert len(result["image_requirements"]) == 3
    assert result["image_requirements"][0]["type"] == "word"
    assert result["image_requirements"][2]["type"] == "sentence"
```

### 8.2 é›†æˆæµ‹è¯•

#### Test 3: å®Œæ•´æµç¨‹ï¼ˆå«å›¾ç‰‡ï¼‰
```
ç”¨æˆ·: /start æµ·æ´‹åŠ¨ç‰©
é¢„æœŸ: Bot ç”Ÿæˆè¯¾ç¨‹åˆç¨¿

ç”¨æˆ·: åŒæ„
é¢„æœŸ: 
  - Bot æç¤º"æ­£åœ¨åˆ†æå›¾ç‰‡éœ€æ±‚..."
  - Bot æç¤º"æ­£åœ¨ç”Ÿæˆ 5 å¼ é…å›¾..."
  - Bot æç¤º"æ­£åœ¨ç”Ÿæˆç½‘é¡µ..."
  - Bot è¿”å›éƒ¨ç½²é“¾æ¥
  
éªŒè¯:
  - è®¿é—®é“¾æ¥ï¼Œç¡®è®¤å›¾ç‰‡å…¨éƒ¨æ˜¾ç¤º
  - æ£€æŸ¥å›¾ç‰‡ç›®å½•å­˜åœ¨ä¸”åŒ…å« 5 å¼ å›¾ç‰‡
```

#### Test 4: ä¿®æ”¹å•å¼ å›¾ç‰‡
```
[åœ¨ç½‘é¡µå®¡æ ¸é˜¶æ®µ]
ç”¨æˆ·: æµ·è±šçš„å›¾ç‰‡èƒŒæ™¯æ”¹æˆæ·±è“è‰²

é¢„æœŸ:
  - Bot è¯†åˆ«å‡ºè¦ä¿®æ”¹çš„æ˜¯ word_dolphin
  - Bot é‡æ–°ç”Ÿæˆè¯¥å›¾ç‰‡
  - Bot æ›´æ–°ç½‘é¡µ
  - Bot è¿”å›æ–°çš„éƒ¨ç½²é“¾æ¥
  
éªŒè¯:
  - æ–°é“¾æ¥ä¸­ dolphin å›¾ç‰‡å·²æ›´æ–°
  - å…¶ä»–å›¾ç‰‡ä¿æŒä¸å˜
```

#### Test 5: å›¾ç‰‡ç”Ÿæˆå¤±è´¥é™çº§
```
[æ¨¡æ‹Ÿ API å¤±è´¥]
é¢„æœŸ:
  - Bot æç¤º"éƒ¨åˆ†å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼ˆ2/5ï¼‰"
  - ä»ç„¶ç”Ÿæˆç½‘é¡µï¼ŒæˆåŠŸçš„å›¾ç‰‡æ­£å¸¸æ˜¾ç¤º
  - å¤±è´¥çš„å›¾ç‰‡ä½ç½®æ˜¾ç¤ºå ä½ç¬¦æˆ–è·³è¿‡
```

### 8.3 æ€§èƒ½æµ‹è¯•

#### Test 6: ç”Ÿæˆæ—¶é—´ç›‘æ§
```python
def test_performance_metrics():
    """è®°å½•å„æ­¥éª¤è€—æ—¶"""
    import time
    
    # å›¾ç‰‡éœ€æ±‚åˆ†æ
    start = time.time()
    analyze_image_needs(state)
    t_analyze = time.time() - start
    
    # å›¾ç‰‡ç”Ÿæˆï¼ˆ7å¼ ï¼‰
    start = time.time()
    generate_images(state)
    t_generate = time.time() - start
    
    print(f"åˆ†æè€—æ—¶: {t_analyze:.2f}s")
    print(f"ç”Ÿæˆè€—æ—¶: {t_generate:.2f}s")
    print(f"å¹³å‡æ¯å¼ : {t_generate/7:.2f}s")
    
    assert t_analyze < 15  # åˆ†æåº”åœ¨ 15s å†…
    assert t_generate < 45  # 7 å¼ å›¾åº”åœ¨ 45s å†…
```

---

## 9. é£é™©ä¸é™çº§ç­–ç•¥

### 9.1 å·²è¯†åˆ«é£é™©

#### é£é™© 1: API ä¸ç¨³å®šæˆ–è¾¾åˆ°é€Ÿç‡é™åˆ¶
- **å½±å“**: å›¾ç‰‡ç”Ÿæˆå¤±è´¥ï¼Œæµç¨‹ä¸­æ–­
- **æ¦‚ç‡**: ä¸­
- **é™çº§ç­–ç•¥**:
  - å®ç°é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
  - è¾¾åˆ°é€Ÿç‡é™åˆ¶æ—¶ï¼Œç­‰å¾…åé‡è¯•
  - å®Œå…¨å¤±è´¥æ—¶ï¼Œç”Ÿæˆæ— å›¾ç‰‡ç‰ˆæœ¬å¹¶é€šçŸ¥ç”¨æˆ·

#### é£é™© 2: å›¾ç‰‡è´¨é‡ä¸ç¬¦åˆé¢„æœŸ
- **å½±å“**: ç”Ÿæˆçš„å›¾ç‰‡ä¸é€‚åˆå„¿ç«¥æˆ–ä¸å†…å®¹ä¸ç¬¦
- **æ¦‚ç‡**: ä¸­
- **ç¼“è§£æªæ–½**:
  - åœ¨ Prompt ä¸­å¼ºè°ƒ"child-friendly", "educational"
  - æä¾›ç”¨æˆ·ä¿®æ”¹åŠŸèƒ½
  - è¿­ä»£ä¼˜åŒ– Prompt æ¨¡æ¿

#### é£é™© 3: æˆæœ¬è¶…é¢„ç®—
- **å½±å“**: æœˆåº¦ API è´¹ç”¨è¶…å‡ºé¢„æœŸ
- **æ¦‚ç‡**: ä½
- **ç¼“è§£æªæ–½**:
  - ç›‘æ§æ¯æ—¥ API è°ƒç”¨é‡
  - è®¾ç½®æœˆåº¦é¢„ç®—è­¦æŠ¥ï¼ˆå¦‚ $20ï¼‰
  - å®ç°ç¼“å­˜æœºåˆ¶ï¼ˆå¸¸è§å•è¯å¤ç”¨å›¾ç‰‡ï¼‰

#### é£é™© 4: å›¾ç‰‡ç”Ÿæˆè€—æ—¶è¿‡é•¿
- **å½±å“**: ç”¨æˆ·ç­‰å¾…æ—¶é—´è¶…è¿‡ 1 åˆ†é’Ÿï¼Œä½“éªŒä¸‹é™
- **æ¦‚ç‡**: ä¸­
- **ç¼“è§£æªæ–½**:
  - åœ¨ Bot ä¸­å®æ—¶åé¦ˆè¿›åº¦ï¼ˆ"æ­£åœ¨ç”Ÿæˆç¬¬ 3/7 å¼ å›¾ç‰‡..."ï¼‰
  - è€ƒè™‘å¼‚æ­¥ç”Ÿæˆï¼ˆç”¨æˆ·å…ˆçœ‹å†…å®¹ï¼Œå›¾ç‰‡åå°ç”Ÿæˆï¼‰
  - å‡å°‘å›¾ç‰‡æ•°é‡ï¼ˆä»…å…³é”®å•è¯é…å›¾ï¼‰

### 9.2 é™çº§æ–¹æ¡ˆçŸ©é˜µ

| åœºæ™¯ | é™çº§ç­–ç•¥ | ç”¨æˆ·ä½“éªŒ |
|------|---------|---------|
| å…¨éƒ¨å›¾ç‰‡ç”Ÿæˆå¤±è´¥ | ç”Ÿæˆçº¯æ–‡æœ¬ç½‘é¡µ | â­â­â­ï¼ˆå¯æ¥å—ï¼‰|
| éƒ¨åˆ†å›¾ç‰‡å¤±è´¥ï¼ˆ<50%ï¼‰ | æ˜¾ç¤ºæˆåŠŸçš„å›¾ç‰‡ | â­â­â­â­ï¼ˆè‰¯å¥½ï¼‰|
| API é€Ÿç‡é™åˆ¶ | ç­‰å¾… 1 åˆ†é’Ÿåé‡è¯• | â­â­â­ï¼ˆå¯æ¥å—ï¼‰|
| å•æ¬¡é‡æ–°ç”Ÿæˆå¤±è´¥ | ä¿ç•™åŸå›¾å¹¶æç¤º | â­â­â­â­ï¼ˆè‰¯å¥½ï¼‰|

---

## 10. é™„å½•

### 10.1 å‚è€ƒæ–‡æ¡£

- [Gemini Image Generation API å®˜æ–¹æ–‡æ¡£](https://ai.google.dev/gemini-api/docs/image-generation)
- [LangGraph å®˜æ–¹æ–‡æ¡£](https://langchain-ai.github.io/langgraph/)
- [åŸéœ€æ±‚æ–‡æ¡£ v1.0](./éœ€æ±‚æ–‡æ¡£.md)
- [åŸç³»ç»Ÿè®¾è®¡æ–‡æ¡£ v1.0](./ç³»ç»Ÿè®¾è®¡æ–‡æ¡£.md)

### 10.2 æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| Nano Banana | Gemini 2.5 Flash Image API çš„éæ­£å¼åç§° |
| ImageRequirement | å›¾ç‰‡éœ€æ±‚å¯¹è±¡ï¼ŒåŒ…å«ç”Ÿæˆä¸€å¼ å›¾ç‰‡æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ |
| GeneratedImage | å·²ç”Ÿæˆçš„å›¾ç‰‡å¯¹è±¡ï¼ŒåŒ…å«è·¯å¾„å’Œå…ƒæ•°æ® |
| lesson_id | è¯¾ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œæ ¼å¼ä¸ºæ—¶é—´æˆ³ YYYYMMDD_HHMMSS |
| é™çº§ç­–ç•¥ | å½“åŠŸèƒ½æ— æ³•æ­£å¸¸æ‰§è¡Œæ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ |

### 10.3 å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|---------|------|
| 2.0 | 2025-11-07 | åˆå§‹ç‰ˆæœ¬ï¼šå›¾ç‰‡ç”ŸæˆåŠŸèƒ½éœ€æ±‚ä¸è®¾è®¡ | AI Tech Architect |

---

**æ–‡æ¡£çŠ¶æ€**: âœ… å·²å®Œæˆéœ€æ±‚åˆ†æï¼Œå‡†å¤‡è¿›å…¥å¼€å‘é˜¶æ®µ

**ä¸‹ä¸€æ­¥**: å¼€å§‹è¿­ä»£ 1 - åŸºç¡€å›¾ç‰‡ç”ŸæˆåŠŸèƒ½å®ç°

